---
title: "TwoMillion"
draft: false
---

---

Nmap scan the target for available TCP ports

![nmap scan](/captures/screens/TwoMillion/shot-001.png)

---

To be able to view the website in browser the target IP must be resolved by creating a domain mapping in /etc/hosts

![/etc/hosts](/captures/screens/TwoMillion/shot-002.png)

---

We run burpsuite and examine the available path of the target under the 'target' tab

Under http://2million.htb/invite it is observed that an invite code is required for Sign Up

![/invite](/captures/screens/TwoMillion/shot-003.png)

After further examination of the website's source, under js/invite.min.js an eval based javascript packer obfuscation script is found in the response window of burpsuite.

![obfuscated script](/captures/screens/TwoMillion/shot-004.png)

Utilizing https://tunganhken.github.io/de4js/ the obfuscated JavaScript was deobfuscated and beautified, revealing functions that directly invoke backend API endpoints.

![beautified script](/captures/screens/TwoMillion/shot-005.png)

Then using curl a POST request is sent to the backend endpoint, with a ROT13 cipher 'data' value.

![rot13 cipher](/captures/screens/TwoMillion/shot-006.png)

https://cryptii.com/pipes/rot13-decoder is a web tool that helped with the decipher of the provided ROT13. 

The cipher's output:
- In order to generate the invite code, make a POST request to \/api\/v1\/invite\/generate

Thus, we test the newly found endpoint resulting to a base64 encoded 'code' value.

![base64 encoded](/captures/screens/TwoMillion/shot-007.png)

The encoded string can be decoded with https://www.base64decode.org/. 

The decoded string based on the generated base64 encoding:
- X43BI-41KBY-4HMSL-SYVEG

Once the decoded string is filled in the empty box of /invite, we get redirected to /register for registration. Next, the appropriate details are entered in /login and access to our personal /home page is granted.

![/home](/captures/screens/TwoMillion/shot-008.png)

After, further examination of the website, it is found that only within /home/access two endpoints share the same prefix /api/v1. It is observed by hovering over 'Connection Pack' and 'Regenerate' buttons.

Thus, a browse to http://2million.htb/api/v1 various other endpoints are displayed.

Note: To be able to view /api/v1 responses, the current created user must be logged in. Since the namespace requires authentication via PHPSESSID. 

![shot-009](/captures/screens/TwoMillion/shot-009.png)

Three endpoints were exposed related to admin, with each respective HTTP method:
- /api/v1/admin/auth
- /api/v1/admin/vpn/generate
- /api/v1/admin/settings/update

Next, using Burpsuite we request each admin related endpoint with the appropriate HTTP method as identified in /api/v1 namespace.

![shot-010](/captures/screens/TwoMillion/shot-010.png)

A GET request to /api/v1/admin/auth provides a json response message, indicating that the current logged in user is not an admin.

![shot-011](/captures/screens/TwoMillion/shot-011.png)

Since, the current user is does not have administrative access, a POST request to /api/v1/admin/vpn/generate, provides a response indicating that we are unauthorized.

![shot-012](/captures/screens/TwoMillion/shot-012.png)

Next, a PUT request to /api/v1/admin/settings/update, shows a response that could be tampered. It appears again that the content type the API accepts as request is application/json.

![shot-013](/captures/screens/TwoMillion/shot-013.png)

On line 11 of the request the content type is specified, and some dummy key:value pair is added to test the response behavior. A message is hinted that an email parameter is missing.


<!-- screenshots:anchor -->

When a valid email is added to the json structure, a new message appears, specifying that is_admin also must be added to the structure.

### shot-014
![shot-014](/captures/screens/TwoMillion/shot-014.png)

As properly assumed, is_admin is a boolean variable. Hence by passing a value of 1, in the response's json struct key is_admin is set to 1 (true).

### shot-015
![shot-015](/captures/screens/TwoMillion/shot-015.png)

When a new GET request is made in /api/v1/admin/auth, the response indicates that the created user now has administrative privileges.

### shot-016
![shot-016](/captures/screens/TwoMillion/shot-016.png)

The response from a reqest to /api/v1/admin/vpn/generate, contains an OpenVPN client profile generated by an administrative API endpoint. Including CA-signed client certificates and private key, potentially enabling direct VPN access to the internal network with elevated privileges.

Hence, the OpenVNP client generation, appeared like a system level operation. Which resulted in a command injection probe, that exposed some local directories of the target.

![shot-017](/captures/screens/TwoMillion/shot-017.png)

---

Environment variable values are keyâ€“value strings stored by the operating system and made available to running processes. Effectively, influencing application behaviors without changing code.

When probed the .env file of the target, various key-value pairs shown environment variables linked to the database of the application.

![shot-018](/captures/screens/TwoMillion/shot-018.png)
