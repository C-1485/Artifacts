<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>
Eighteen | ARTIFACTS
</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">

<meta name="generator" content="Hugo 0.152.2">


<link rel="canonical" href="http://localhost:1313/captures/eighteen/" >




<link href="/css/style.min.0ad1e2c9a962b88a0849baa9f650011fd6dd9ea8dafc2cac9755a1a524709020.css" rel="stylesheet">




</head>

<body>

    <div class="flexWrapper">
        <header class="headerWrapper">
    <div class="header">
        <div>
            <a class="terminal" href="/">
                <span>C-1485@artifacts.io ~ $</span>
            </a>
        </div>
        <input class="side-menu" type="checkbox" id="side-menu">
        <label class="hamb" for="side-menu"><span class="hamb-line"></span></label>
        <nav class="headerLinks">
            <ul>
                
                <li>
                    <a href="http://localhost:1313/projects" title="" >
                        ~/projects</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/captures" title="" >
                        ~/captures</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/playbooks" title="" >
                        ~/playbooks</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/about" title="" >
                        ~/about</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


        <div class="content">
            <main class="main">
                
<div class="postWrapper">
    <h1>Eighteen</h1>
    

    
    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    <section class="postMetadata">
        <dl>
            
                <dt>tags</dt>
<dd><span></span>HackTheBox Machines</dd>
            
            
            
            
            
            
                <dt>reading time</dt>
                <dd>3 minutes</dd>
            
        </dl>
    </section>
    
    <div>
        <h4 id="write-up-for-the-hackthebox-machine---browsed">Write-Up for the HackTheBox Machine - Browsed</h4>
<hr>
<h4 id="001-port-scan">001: Port Scan</h4>
<p>Initially a scan was performed against the victim to identify potential attack surfaces.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -sC -sV -p- &lt;victim_ip&gt;
</span></span></code></pre></div><p>Based on the used command the scanner&rsquo;s report provided three open ports that could be used against the target.</p>
<ul>
<li><code>80 : Microsoft IIS</code></li>
<li><code>1433 : Microsoft SQL Server 2022</code></li>
<li><code>5985 : Microsoft HTTPAPI (WinRM)</code></li>
</ul>
<p align="center">
  <img src="/captures/screens/Eighteen/shot-001.png" alt="shot-001">
</p>
<hr>
<h4 id="002-hostname-mapping">002: Hostname Mapping</h4>
<p>A DNS does not resolve the victim&rsquo;s IP, thus a mapping must be added in <code>/etc/hosts</code> to be able to browse the hostname <code>eighteen.htb</code> as found from the <code>nmap</code> scan.</p>
<hr>
<h4 id="003-port-80-enumeration">003: Port 80 Enumeration</h4>
<p>User sessions expire after a short period of inactivity, redirecting to the <code>/login</code> page. Previously registered credentials can not be reused, indicating non-persistent user storage rather than a proper backend account system. Regardless after many attempts to log in with the previously registered credentials an error exposes a Microsoft SQL Server message related to duplicate key violation.</p>
<ul>
<li><code>dbo.users : The duplicate key value is (c@c.com). (2627)</code></li>
</ul>
<p align="center">
  <img src="/captures/screens/Eighteen/shot-002.png" alt="shot-002">
</p>
<hr>
<h4 id="004-port-1433-enumeration">004: Port 1433 Enumeration</h4>
<p>Given that Microsoft SQL Server 2022 is open and the credentials <code>kevin:iNa2we6haRj2gaw!</code>, a Python script was utilized for server connectivity.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find / -name mssqlclient.py 2&gt;/dev/null
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 mssqlclient.py <span style="color:#e6db74">&#39;kevin:iNa2we6haRj2gaw!@&lt;victim_ip&gt;&#39;</span>
</span></span></code></pre></div><p align="center">
  <img src="/captures/screens/Eighteen/shot-003.png" alt="shot-003">
</p>
<p>A handful of databases are available on the victim, however out of all the one that seemed most interesting is <code>financial_planner</code>. Although as the current user <code>kevin</code> permission to use the database is not sufficient.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> name <span style="color:#66d9ef">FROM</span> sys.databases;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>use financial_planner;
</span></span></code></pre></div><p align="center">
  <img src="/captures/screens/Eighteen/shot-004.png" alt="shot-004">
</p>
<p>As a subsequent step the SQL server is examined for potential users that can be leveraged. There are three noticeable users, but only one can be impersonated and effectively execute privileged queries on the target SQL server.</p>
<ul>
<li><code>appdev</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> loginname <span style="color:#66d9ef">FROM</span> syslogins;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>enum_impersonate
</span></span></code></pre></div><p>The precedent inaccessible database becomes available when switching to the impersonated user. In <code>users</code> table within the <code>financial_planner</code> database a single entry is found with a hashed password.</p>
<ul>
<li><code>pbkdf2:sha256:600000$AMtzteQIG7yAbZIa$0673ad90a0b4afb19d662336f0fce3a9edd0b7b19193717be28ce4d66c887133</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> name <span style="color:#66d9ef">FROM</span> sys.tables;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> users;
</span></span></code></pre></div><p align="center">
  <img src="/captures/screens/Eighteen/shot-005.png" alt="shot-005">
</p>
<hr>
<h4 id="005-hash-crack">005: Hash Crack</h4>
<p>The hashing function PBKDF2-HMAC-SHA256 is designed to be irreversible and computationally expensive. Nonetheless, a GitHub repository 
<a href="https://github.com/qui113x/Werkzeug-PBKDF2-Hash-Converter" target="_blank" rel="noopener">Werkzeug-PBKDF2-Hash-Converter</a>
 provides a concise conversion process, compatible for Hashcat. The execution of the script converted the salt and hex values to a Base64 encoding.</p>
<ul>
<li><code>sha256:600000:QU10enRlUUlHN3lBYlpJYQ==:BnOtkKC0r7GdZiM28Pzjqe3Qt7GRk3F74ozk1myIcTM=</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/qui113x/Werkzeug-PBKDF2-Hash-Converter
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 pbkdf2-hashconv.py
</span></span></code></pre></div><p align="center">
  <img src="/captures/screens/Eighteen/shot-006.png" alt="shot-006">
</p>
<p>According to the description of the found repository, the converted value was added in text file named <code>hash.txt</code>. Hashcat has successfully recovered a password with the use of the <code>rockyou.txt</code> wordlist and a set mode for PBKDF2-HMAC-SHA256.</p>
<ul>
<li><code>sha256:600000:QU10enRlUUlHN3lBYlpJYQ==:BnOtkKC0r7GdZiM28Pzjqe3Qt7GRk3F74ozk1myIcTM=:iloveyou1</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>hashcat -m <span style="color:#ae81ff">10900</span> hash.txt /usr/share/wordlists/rockyou.txt
</span></span></code></pre></div><p align="center">
  <img src="/captures/screens/Eighteen/shot-007.png" alt="shot-007">
</p>
<hr>
<h4 id="006-domain-controller-objects">006: Domain Controller Objects</h4>
<p>Further examination revealed the exposure of multiple domain objects resident within the target environment. Through the automated enumeration of relative identifiers, numerous directory objects were identified, including several user-associated principals of potential operational interest. A subset of objects corresponding to user accounts was extracted and preserved within a text file <code>userobjects.txt</code> for subsequent authentication testing.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nxc mssql 10.129.8.48 -u kevin -p <span style="color:#e6db74">&#39;iNa2we6haRj2gaw!&#39;</span> --local-auth --rid-brute
</span></span></code></pre></div><p align="center">
  <img src="/captures/screens/Eighteen/shot-008.png" alt="shot-008">
</p>
<hr>
<h4 id="007-port-5985-enumeration">007: Port 5985 Enumeration</h4>
    </div>
</div>

            </main>
        </div>


        <footer class="footer">
    
        <span>
            ♣ ♦ ♠ ♥ 
        </span>
    
</footer>
    </div>

</body>

</html>
