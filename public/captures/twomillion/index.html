<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>
TwoMillion | ARTIFACTS
</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">

<meta name="generator" content="Hugo 0.152.2">


<link rel="canonical" href="http://localhost:1313/captures/twomillion/" >




<link href="/css/style.min.b2219dd89d90a11a5d98117f8c30d449377dec34f0afd572d006bdc58cc2dd97.css" rel="stylesheet">




</head>

<body>

    <div class="flexWrapper">
        <header class="headerWrapper">
    <div class="header">
        <div>
            <a class="terminal" href="/">
                <span>C-1485@artifacts.io ~ $</span>
            </a>
        </div>
        <input class="side-menu" type="checkbox" id="side-menu">
        <label class="hamb" for="side-menu"><span class="hamb-line"></span></label>
        <nav class="headerLinks">
            <ul>
                
                <li>
                    <a href="http://localhost:1313/posts" title="" >
                        ~/posts</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/captures" title="" >
                        ~/captures</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/about" title="" >
                        ~/about</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


        <div class="content">
            <main class="main">
                
<div class="postWrapper">
    <h1>TwoMillion</h1>
    

    
    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    <section class="postMetadata">
        <dl>
            
            
            
            
            
            
                <dt>reading time</dt>
                <dd>3 minutes</dd>
            
        </dl>
    </section>
    
    <div>
        <hr>
<p>Nmap scan the target for available TCP ports</p>
<p><img src="/captures/screens/TwoMillion/shot-001.png" alt="nmap scan"></p>
<hr>
<p>To be able to view the website in browser the target IP must be resolved by creating a domain mapping in /etc/hosts</p>
<p><img src="/captures/screens/TwoMillion/shot-002.png" alt="/etc/hosts"></p>
<hr>
<p>We run burpsuite and examine the available path of the target under the &rsquo;target&rsquo; tab</p>
<p>Under 
<a href="http://2million.htb/invite" target="_blank" rel="noopener">http://2million.htb/invite</a>
 it is observed that an invite code is required for Sign Up</p>
<p><img src="/captures/screens/TwoMillion/shot-003.png" alt="/invite"></p>
<p>After further examination of the website&rsquo;s source, under js/invite.min.js an eval based javascript packer obfuscation script is found in the response window of burpsuite.</p>
<p><img src="/captures/screens/TwoMillion/shot-004.png" alt="obfuscated script"></p>
<p>Utilizing 
<a href="https://tunganhken.github.io/de4js/" target="_blank" rel="noopener">https://tunganhken.github.io/de4js/</a>
 the obfuscated JavaScript was deobfuscated and beautified, revealing functions that directly invoke backend API endpoints.</p>
<p><img src="/captures/screens/TwoMillion/shot-005.png" alt="beautified script"></p>
<p>Then using curl a POST request is sent to the backend endpoint, with a ROT13 cipher &lsquo;data&rsquo; value.</p>
<p><img src="/captures/screens/TwoMillion/shot-006.png" alt="rot13 cipher"></p>
<p>
<a href="https://cryptii.com/pipes/rot13-decoder" target="_blank" rel="noopener">https://cryptii.com/pipes/rot13-decoder</a>
 is a web tool that helped with the decipher of the provided ROT13.</p>
<p>The cipher&rsquo;s output:</p>
<ul>
<li>In order to generate the invite code, make a POST request to /api/v1/invite/generate</li>
</ul>
<p>Thus, we test the newly found endpoint resulting to a base64 encoded &lsquo;code&rsquo; value.</p>
<p><img src="/captures/screens/TwoMillion/shot-007.png" alt="base64 encoded"></p>
<p>The encoded string can be decoded with 
<a href="https://www.base64decode.org/" target="_blank" rel="noopener">https://www.base64decode.org/</a>
.</p>
<p>The decoded string based on the generated base64 encoding:</p>
<ul>
<li>X43BI-41KBY-4HMSL-SYVEG</li>
</ul>
<p>Once the decoded string is filled in the empty box of /invite, we get redirected to /register for registration. Next, the appropriate details are entered in /login and access to our personal /home page is granted.</p>
<p><img src="/captures/screens/TwoMillion/shot-008.png" alt="/home"></p>
<p>After, further examination of the website, it is found that only within /home/access two endpoints share the same prefix /api/v1. It is observed by hovering over &lsquo;Connection Pack&rsquo; and &lsquo;Regenerate&rsquo; buttons.</p>
<p>Thus, a browse to 
<a href="http://2million.htb/api/v1" target="_blank" rel="noopener">http://2million.htb/api/v1</a>
 various other endpoints are displayed.</p>
<p>Note: To be able to view /api/v1 responses, the current created user must be logged in. Since the namespace requires authentication via PHPSESSID.</p>
<p><img src="/captures/screens/TwoMillion/shot-009.png" alt="shot-009"></p>
<p>Three endpoints were exposed related to admin, with each respective HTTP method:</p>
<ul>
<li>/api/v1/admin/auth</li>
<li>/api/v1/admin/vpn/generate</li>
<li>/api/v1/admin/settings/update</li>
</ul>
<p>Next, using Burpsuite we request each admin related endpoint with the appropriate HTTP method as identified in /api/v1 namespace.</p>
<p><img src="/captures/screens/TwoMillion/shot-010.png" alt="shot-010"></p>
<p>A GET request to /api/v1/admin/auth provides a json response message, indicating that the current logged in user is not an admin.</p>
<p><img src="/captures/screens/TwoMillion/shot-011.png" alt="shot-011"></p>
<p>Since, the current user is does not have administrative access, a POST request to /api/v1/admin/vpn/generate, provides a response indicating that we are unauthorized.</p>
<p><img src="/captures/screens/TwoMillion/shot-012.png" alt="shot-012"></p>
<p>Next, a PUT request to /api/v1/admin/settings/update, shows a response that could be tampered. It appears again that the content type the API accepts as request is application/json.</p>
<p><img src="/captures/screens/TwoMillion/shot-013.png" alt="shot-013"></p>
<p>On line 11 of the request the content type is specified, and some dummy key:value pair is added to test the response behavior. A message is hinted that an email parameter is missing.</p>
<!-- screenshots:anchor -->
<p>When a valid email is added to the json structure, a new message appears, specifying that is_admin also must be added to the structure.</p>
<h3 id="shot-014">shot-014</h3>
<p><img src="/captures/screens/TwoMillion/shot-014.png" alt="shot-014"></p>
<p>As properly assumed, is_admin is a boolean variable. Hence by passing a value of 1, in the response&rsquo;s json struct key is_admin is set to 1 (true).</p>
<h3 id="shot-015">shot-015</h3>
<p><img src="/captures/screens/TwoMillion/shot-015.png" alt="shot-015"></p>
<p>When a new GET request is made in /api/v1/admin/auth, the response indicates that the created user now has administrative privileges.</p>
<h3 id="shot-016">shot-016</h3>
<p><img src="/captures/screens/TwoMillion/shot-016.png" alt="shot-016"></p>
<p>The response from a reqest to /api/v1/admin/vpn/generate, contains an OpenVPN client profile generated by an administrative API endpoint. Including CA-signed client certificates and private key, potentially enabling direct VPN access to the internal network with elevated privileges.</p>
<p>Hence, the OpenVNP client generation, appeared like a system level operation. Which resulted in a command injection probe, that exposed some local directories of the target.</p>
<p><img src="/captures/screens/TwoMillion/shot-017.png" alt="shot-017"></p>
<hr>
<p>Environment variable values are key–value strings stored by the operating system and made available to running processes. Effectively, influencing application behaviors without changing code.</p>
<p>When probed the .env file of the target, various key-value pairs shown environment variables linked to the database of the application.</p>
<p><img src="/captures/screens/TwoMillion/shot-018.png" alt="shot-018"></p>

    </div>
</div>

            </main>
        </div>


        <footer class="footer">
    
        <span>
            ♣ ♦ ♠ ♥ 
        </span>
    
</footer>
    </div>

</body>

</html>
